<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Gestor de Proyectos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/style.css" />
    <script src="/theme.js" defer></script>
  </head>

  <body>
    <div class="container py-4">

      <!-- 🧑 Autenticación -->
      <div class="user-info mb-3">
        <span>👤 Conectado como <strong><%= currentUser.username %></strong></span>
        <form action="/logout" method="POST" style="display:inline;">
          <button type="submit" class="btn btn-sm btn-outline-secondary ms-2">Cerrar sesión</button>
        </form>
      </div>

      <!-- 🌙 Botón para cambiar tema -->
      <div class="text-end mb-3">
        <button id="toggleTheme" class="btn-link">
          <span id="themeIcon">🌙</span> Cambiar tema
        </button>
      </div>

      <!-- 📝 Formulario para agregar proyectos -->
      <h1 class="text-center mb-4">📝 Gestor de Proyectos</h1>
      <div class="card shadow-sm p-4 mb-4">
        <form action="/add-project" method="POST" class="d-flex gap-2">
          <input name="name" class="form-control" placeholder="Nombre del proyecto" required />
          <button class="btn btn-primary" type="submit">Agregar proyecto</button>
        </form>
      </div>

      <!-- 📋 Lista de proyectos -->
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% projects.forEach(p => { %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="/project/<%= p._id %>"><%= p.name %></a>
                </h5>
                <div class="mt-2">
                  <a href="/project/<%= p._id %>/edit" class="btn btn-sm btn-warning">✏️ Editar</a>
                </div>
              </div>
              <div class="card-footer text-end">
                <form action="/project/<%= p._id %>/delete" method="POST" onsubmit="return confirm('¿Eliminar este proyecto?')">
                  <button class="btn btn-sm btn-danger">🗑️ Eliminar</button>
                </form>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </div>

    <!-- 🌗 Script para cambiar el tema -->
    <script>
      const toggleButton = document.getElementById("toggleTheme");
      const themeIcon = document.getElementById("themeIcon");
      const body = document.body;

      function actualizarIcono() {
        themeIcon.textContent = body.classList.contains("dark-mode") ? "☀️" : "🌙";
      }

      if (localStorage.getItem("theme") === "dark") {
        body.classList.add("dark-mode");
      }

      actualizarIcono();

      toggleButton.addEventListener("click", () => {
        body.classList.toggle("dark-mode");
        const theme = body.classList.contains("dark-mode") ? "dark" : "light";
        localStorage.setItem("theme", theme);
        actualizarIcono();
      });
    </script>
  </body>
</html>

